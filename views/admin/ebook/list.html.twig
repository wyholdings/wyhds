{% extends 'admin/layout/base.html.twig' %}

{% block content %}
<h1>eBook 목록</h1>
<p class="text-muted mb-3">총 {{ total|default(0) }}건 ({{ page|default(1) }}/{{ total_pages|default(1) }} 페이지)</p>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>원본 파일명</th>
            <th>폴더 이름</th>
            <th>등록일</th>
            <th>관리</th>
        </tr>
    </thead>
    <tbody>
        {% for ebook in ebooks %}
        <tr>
            <td>{{ ebook.id }}</td>
            <td>{{ ebook.file_name }}</td>
            <td>{{ ebook.folder_name }}</td>
            <td>{{ ebook.created_at|date('Y-m-d') }}</td>
            <td>
                {# 뷰어로 이동 (온라인 보기) #}
                <a href="/ebooks/{{ ebook.folder_name }}/index.html"
                   class="btn btn-sm btn-primary"
                   target="_blank">
                    뷰어로 이동
                </a>

                {# ZIP 다운로드 (어디 사이트든 업로드용) #}
                <a href="/admin/ebook/download/{{ ebook.folder_name }}"
                   class="btn btn-sm btn-danger">
                    ZIP 다운로드
                </a>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5" class="text-center">등록된 eBook이 없습니다.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if total_pages|default(1) > 1 %}
<nav aria-label="pagination" class="mt-3">
    <ul class="pagination">
        {% set prev = page - 1 %}
        {% set next = page + 1 %}
        <li class="page-item {{ page == 1 ? 'disabled' : '' }}">
            <a class="page-link" href="/admin/ebook/list?page={{ prev }}">이전</a>
        </li>
        {% for p in 1..total_pages %}
            {% if p == page or (p <= 3) or (p > total_pages-3) or (p >= page-2 and p <= page+2) %}
                <li class="page-item {{ p == page ? 'active' : '' }}">
                    <a class="page-link" href="/admin/ebook/list?page={{ p }}">{{ p }}</a>
                </li>
            {% elseif loop.index0 == 3 or loop.index0 == total_pages-3 %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
        <li class="page-item {{ page == total_pages ? 'disabled' : '' }}">
            <a class="page-link" href="/admin/ebook/list?page={{ next }}">다음</a>
        </li>
    </ul>
</nav>
{% endif %}

<hr>

<h3>새 eBook 업로드</h3>
<form method="POST" enctype="multipart/form-data" action="/admin/ebook/upload">
    <label>eBook PDF 파일 업로드:</label><br>
    <input type="file" name="pdf" accept="application/pdf" required>
    <button class="btn btn-primary mt-2" type="submit">변환 및 다운로드</button>
</form>
{% endblock %}
